<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test H·ªá Th·ªëng Ti·ªÉu ƒêo√†n 15</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-gray-100">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Supabase config
        const supabase = window.supabase.createClient(
            'https://hpgyuftvxnmogbcdlymc.supabase.co',
            'sb_publishable_58fTH5rZSW5A5Rsw1oq6Fw_XfiKAghq'
        );

        function TestApp() {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(false);
            const [email, setEmail] = useState('admin@su324.vn');
            const [password, setPassword] = useState('admin');
            const [message, setMessage] = useState('');
            const [activeTab, setActiveTab] = useState('test');
            const [testResults, setTestResults] = useState({});

            // Test functions
            const testConnection = async () => {
                setLoading(true);
                try {
                    const results = {};
                    
                    // Test 1: Ki·ªÉm tra k·∫øt n·ªëi users
                    const { data: users, error: usersError } = await supabase
                        .from('users')
                        .select('*')
                        .limit(5);
                    results.users = { success: !usersError, data: users, error: usersError };

                    // Test 2: Ki·ªÉm tra articles
                    const { data: articles, error: articlesError } = await supabase
                        .from('articles')
                        .select('*')
                        .limit(5);
                    results.articles = { success: !articlesError, data: articles, error: articlesError };

                    // Test 3: Ki·ªÉm tra questions
                    const { data: questions, error: questionsError } = await supabase
                        .from('questions')
                        .select('*')
                        .limit(5);
                    results.questions = { success: !questionsError, data: questions, error: questionsError };

                    setTestResults(results);
                    setMessage('‚úÖ Test k·∫øt n·ªëi ho√†n t·∫•t!');
                } catch (error) {
                    setMessage('‚ùå L·ªói: ' + error.message);
                } finally {
                    setLoading(false);
                }
            };

            const login = async (e) => {
                e.preventDefault();
                setLoading(true);
                try {
                    const { data, error } = await supabase
                        .from('users')
                        .select('*')
                        .eq('email', email)
                        .eq('password', password)
                        .single();

                    if (error) throw error;
                    setUser(data);
                    setMessage('‚úÖ ƒêƒÉng nh·∫≠p th√†nh c√¥ng!');
                } catch (error) {
                    setMessage('‚ùå L·ªói ƒëƒÉng nh·∫≠p: ' + error.message);
                } finally {
                    setLoading(false);
                }
            };

            const createTestData = async () => {
                setLoading(true);
                try {
                    // T·∫°o b√†i vi·∫øt test
                    const { data: article, error: articleError } = await supabase
                        .from('articles')
                        .insert({
                            id: 'test_' + Date.now(),
                            title: 'B√†i vi·∫øt test ' + new Date().toLocaleString(),
                            summary: 'ƒê√¢y l√† b√†i vi·∫øt test ƒë·ªÉ ki·ªÉm tra ch·ª©c nƒÉng',
                            content: 'N·ªôi dung chi ti·∫øt c·ªßa b√†i vi·∫øt test...',
                            author: user?.name || 'Test User',
                            date: new Date().toISOString().split('T')[0]
                        })
                        .select()
                        .single();

                    if (articleError) throw articleError;

                    // T·∫°o c√¢u h·ªèi test
                    const { data: question, error: questionError } = await supabase
                        .from('questions')
                        .insert({
                            id: 'q_test_' + Date.now(),
                            question_text: 'C√¢u h·ªèi test t·ª´ h·ªá th·ªëng?',
                            options: JSON.stringify(['ƒê√°p √°n A', 'ƒê√°p √°n B', 'ƒê√°p √°n C', 'ƒê√°p √°n D']),
                            correct_answer_index: 0,
                            explanation: 'ƒê√¢y l√† c√¢u h·ªèi test'
                        })
                        .select()
                        .single();

                    if (questionError) throw questionError;

                    setMessage('‚úÖ T·∫°o d·ªØ li·ªáu test th√†nh c√¥ng!');
                    testConnection(); // Refresh results
                } catch (error) {
                    setMessage('‚ùå L·ªói t·∫°o d·ªØ li·ªáu: ' + error.message);
                } finally {
                    setLoading(false);
                }
            };

            const logout = () => {
                setUser(null);
                setMessage('ƒê√£ ƒëƒÉng xu·∫•t');
            };

            if (!user) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-900 to-blue-600 flex items-center justify-center">
                        <div className="bg-white rounded-lg shadow-xl p-8 w-full max-w-md">
                            <div className="text-center mb-8">
                                <h1 className="text-3xl font-bold text-blue-800 mb-2">Ti·ªÉu ƒêo√†n 15</h1>
                                <p className="text-gray-600">H·ªá th·ªëng Test - S∆∞ ƒêo√†n 324</p>
                            </div>

                            <form onSubmit={login} className="space-y-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Email</label>
                                    <input
                                        type="email"
                                        value={email}
                                        onChange={(e) => setEmail(e.target.value)}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                        required
                                    />
                                </div>

                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Password</label>
                                    <input
                                        type="password"
                                        value={password}
                                        onChange={(e) => setPassword(e.target.value)}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                        required
                                    />
                                </div>

                                <button
                                    type="submit"
                                    disabled={loading}
                                    className="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition font-medium disabled:opacity-50"
                                >
                                    {loading ? 'ƒêang x·ª≠ l√Ω...' : 'ƒêƒÉng nh·∫≠p'}
                                </button>
                            </form>

                            {message && (
                                <div className="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                                    <p className="text-blue-800 text-sm">{message}</p>
                                </div>
                            )}
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gray-100">
                    {/* Header */}
                    <nav className="bg-blue-800 shadow-lg">
                        <div className="max-w-7xl mx-auto px-4">
                            <div className="flex justify-between h-16">
                                <div className="flex items-center">
                                    <h1 className="text-white text-xl font-bold">üèõÔ∏è Ti·ªÉu ƒêo√†n 15 - Test System</h1>
                                </div>
                                <div className="flex items-center space-x-4">
                                    <span className="text-white">üë§ {user.name}</span>
                                    <span className="text-yellow-300">‚≠ê {user.rank_name}</span>
                                    <button
                                        onClick={logout}
                                        className="bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700 transition"
                                    >
                                        ƒêƒÉng xu·∫•t
                                    </button>
                                </div>
                            </div>
                        </div>
                    </nav>

                    {/* Main Content */}
                    <div className="max-w-7xl mx-auto px-4 py-8">
                        <div className="bg-white rounded-lg shadow-xl p-6">
                            <h2 className="text-2xl font-bold mb-6 text-blue-800">üß™ Test Ch·ª©c NƒÉng H·ªá Th·ªëng</h2>

                            {/* Tabs */}
                            <div className="flex space-x-4 mb-6 border-b">
                                <button
                                    onClick={() => setActiveTab('test')}
                                    className={`px-4 py-2 font-medium ${activeTab === 'test' ? 'border-b-2 border-blue-600 text-blue-600' : 'text-gray-600'}`}
                                >
                                    üìä Test K·∫øt N·ªëi
                                </button>
                                <button
                                    onClick={() => setActiveTab('data')}
                                    className={`px-4 py-2 font-medium ${activeTab === 'data' ? 'border-b-2 border-blue-600 text-blue-600' : 'text-gray-600'}`}
                                >
                                    üìù Qu·∫£n L√Ω D·ªØ Li·ªáu
                                </button>
                                <button
                                    onClick={() => setActiveTab('api')}
                                    className={`px-4 py-2 font-medium ${activeTab === 'api' ? 'border-b-2 border-blue-600 text-blue-600' : 'text-gray-600'}`}
                                >
                                    üîß API Test
                                </button>
                            </div>

                            {/* Test Connection Tab */}
                            {activeTab === 'test' && (
                                <div>
                                    <div className="mb-6">
                                        <button
                                            onClick={testConnection}
                                            disabled={loading}
                                            className="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition font-medium disabled:opacity-50"
                                        >
                                            {loading ? '‚è≥ ƒêang test...' : 'üöÄ Test K·∫øt N·ªëi Database'}
                                        </button>
                                    </div>

                                    {Object.keys(testResults).length > 0 && (
                                        <div className="space-y-4">
                                            <h3 className="font-semibold text-lg mb-3">üìã K·∫øt Qu·∫£ Test:</h3>
                                            
                                            {testResults.users && (
                                                <div className={`p-4 rounded-lg ${testResults.users.success ? 'bg-green-50 border-green-200' : 'bg-red-50 border-red-200'} border`}>
                                                    <h4 className="font-semibold mb-2">üë• Users Table</h4>
                                                    <p className="text-sm">
                                                        Status: {testResults.users.success ? '‚úÖ Success' : '‚ùå Error'}
                                                    </p>
                                                    {testResults.users.data && (
                                                        <p className="text-sm">T√¨m th·∫•y {testResults.users.data.length} users</p>
                                                    )}
                                                    {testResults.users.error && (
                                                        <p className="text-sm text-red-600">Error: {testResults.users.error.message}</p>
                                                    )}
                                                </div>
                                            )}

                                            {testResults.articles && (
                                                <div className={`p-4 rounded-lg ${testResults.articles.success ? 'bg-green-50 border-green-200' : 'bg-red-50 border-red-200'} border`}>
                                                    <h4 className="font-semibold mb-2">üì∞ Articles Table</h4>
                                                    <p className="text-sm">
                                                        Status: {testResults.articles.success ? '‚úÖ Success' : '‚ùå Error'}
                                                    </p>
                                                    {testResults.articles.data && (
                                                        <p className="text-sm">T√¨m th·∫•y {testResults.articles.data.length} b√†i vi·∫øt</p>
                                                    )}
                                                    {testResults.articles.error && (
                                                        <p className="text-sm text-red-600">Error: {testResults.articles.error.message}</p>
                                                    )}
                                                </div>
                                            )}

                                            {testResults.questions && (
                                                <div className={`p-4 rounded-lg ${testResults.questions.success ? 'bg-green-50 border-green-200' : 'bg-red-50 border-red-200'} border`}>
                                                    <h4 className="font-semibold mb-2">‚ùì Questions Table</h4>
                                                    <p className="text-sm">
                                                        Status: {testResults.questions.success ? '‚úÖ Success' : '‚ùå Error'}
                                                    </p>
                                                    {testResults.questions.data && (
                                                        <p className="text-sm">T√¨m th·∫•y {testResults.questions.data.length} c√¢u h·ªèi</p>
                                                    )}
                                                    {testResults.questions.error && (
                                                        <p className="text-sm text-red-600">Error: {testResults.questions.error.message}</p>
                                                    )}
                                                </div>
                                            )}
                                        </div>
                                    )}
                                </div>
                            )}

                            {/* Data Management Tab */}
                            {activeTab === 'data' && (
                                <div>
                                    <div className="mb-6">
                                        <button
                                            onClick={createTestData}
                                            disabled={loading}
                                            className="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition font-medium disabled:opacity-50"
                                        >
                                            {loading ? '‚è≥ ƒêang t·∫°o...' : '‚ûï T·∫°o D·ªØ Li·ªáu Test'}
                                        </button>
                                        <p className="text-sm text-gray-600 mt-2">T·∫°o b√†i vi·∫øt v√† c√¢u h·ªèi m·∫´u ƒë·ªÉ test</p>
                                    </div>

                                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <div className="bg-blue-50 p-4 rounded-lg border border-blue-200">
                                            <h3 className="font-semibold text-blue-800 mb-2">üë• Users</h3>
                                            <p className="text-sm text-gray-600">Qu·∫£n l√Ω c√°n b·ªô, chi·∫øn sƒ©</p>
                                        </div>
                                        <div className="bg-green-50 p-4 rounded-lg border border-green-200">
                                            <h3 className="font-semibold text-green-800 mb-2">üì∞ Articles</h3>
                                            <p className="text-sm text-gray-600">Qu·∫£n l√Ω tin t·ª©c, th√¥ng b√°o</p>
                                        </div>
                                        <div className="bg-purple-50 p-4 rounded-lg border border-purple-200">
                                            <h3 className="font-semibold text-purple-800 mb-2">‚ùì Quiz</h3>
                                            <p className="text-sm text-gray-600">Qu·∫£n l√Ω c√¢u h·ªèi tr·∫Øc nghi·ªám</p>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* API Test Tab */}
                            {activeTab === 'api' && (
                                <div>
                                    <div className="bg-gray-50 p-4 rounded-lg">
                                        <h3 className="font-semibold mb-3">üîó API Endpoints</h3>
                                        <div className="space-y-2 text-sm font-mono">
                                            <p>‚Ä¢ GET /users - L·∫•y danh s√°ch users</p>
                                            <p>‚Ä¢ POST /users - T·∫°o user m·ªõi</p>
                                            <p>‚Ä¢ GET /articles - L·∫•y danh s√°ch b√†i vi·∫øt</p>
                                            <p>‚Ä¢ POST /articles - T·∫°o b√†i vi·∫øt m·ªõi</p>
                                            <p>‚Ä¢ GET /questions - L·∫•y danh s√°ch c√¢u h·ªèi</p>
                                            <p>‚Ä¢ POST /questions - T·∫°o c√¢u h·ªèi m·ªõi</p>
                                        </div>
                                        <p className="mt-3 text-xs text-gray-600">
                                            Base URL: https://hpgyuftvxnmogbcdlymc.supabase.co/rest/v1/
                                        </p>
                                    </div>
                                </div>
                            )}

                            {/* Message Display */}
                            {message && (
                                <div className="mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                                    <p className="text-blue-800">{message}</p>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<TestApp />, document.getElementById('root'));
    </script>
</body>
</html>
